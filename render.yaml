services:
  # Sentinel Proxy (Java Spring Boot via Docker)
  - type: web
    name: sentinel-proxy
    runtime: docker
    plan: free
    dockerfilePath: ./proxy/Dockerfile
    envVars:
      - key: BACKEND_1_URL
        fromService:
          type: web
          name: backend-1
          envVarKey: RENDER_EXTERNAL_URL
      - key: BACKEND_2_URL
        fromService:
          type: web
          name: backend-2
          envVarKey: RENDER_EXTERNAL_URL
      - key: BACKEND_3_URL
        fromService:
          type: web
          name: backend-3
          envVarKey: RENDER_EXTERNAL_URL

  # Backend 1 (Node.js)
  - type: web
    name: backend-1
    runtime: node
    plan: free
    buildCommand: cd simulator && npm install
    startCommand: cd simulator && node server.js
    envVars:
      - key: BACKEND_ID
        value: backend-1
      - key: BASE_LATENCY_MS
        value: 50
      - key: MAX_CAPACITY
        value: 50

  # Backend 2 (Node.js)
  - type: web
    name: backend-2
    runtime: node
    plan: free
    buildCommand: cd simulator && npm install
    startCommand: cd simulator && node server.js
    envVars:
      - key: BACKEND_ID
        value: backend-2
      - key: BASE_LATENCY_MS
        value: 50
      - key: MAX_CAPACITY
        value: 50

  # Backend 3 (Node.js)
  - type: web
    name: backend-3
    runtime: node
    plan: free
    buildCommand: cd simulator && npm install
    startCommand: cd simulator && node server.js
    envVars:
      - key: BACKEND_ID
        value: backend-3
      - key: BASE_LATENCY_MS
        value: 50
      - key: MAX_CAPACITY
        value: 50
